{
	"debug": true,
	"vars": {
		"distance_to_home": " Math.sqrt( Math.pow( 111.1 * ( ${home-latitude} - ${body.drive_state.latitude} ), 2) + Math.pow( 85.1 * ( ${home-longitude} - ${body.drive_state.longitude} ), 2) ) ",
		"distance_to_work": " Math.sqrt( Math.pow( 111.1 * ( ${work-latitude} - ${body.drive_state.latitude} ), 2) + Math.pow( 85.1 * ( ${work-longitude} - ${body.drive_state.longitude} ), 2) ) ",
		"psi_pressure_front_left": "14.503773773 * ${body.vehicle_state.tpms_pressure_fl}",
		"psi_pressure_front_right": "14.503773773 * ${body.vehicle_state.tpms_pressure_fr}",
		"psi_pressure_rear_left": "14.503773773 * ${body.vehicle_state.tpms_pressure_rl}",
		"psi_pressure_rear_right": "14.503773773 * ${body.vehicle_state.tpms_pressure_rr}",
		"percent_pressure_front_left": "14.503773773 * ${body.vehicle_state.tpms_pressure_fl} * 100 / ${target-tire-pressure-front}",
		"percent_pressure_front_right": "14.503773773 * ${body.vehicle_state.tpms_pressure_fr} * 100 / ${target-tire-pressure-front}",
		"percent_pressure_rear_left": "14.503773773 * ${body.vehicle_state.tpms_pressure_rl} * 100 / ${target-tire-pressure-rear}",
		"percent_pressure_rear_right": "14.503773773 * ${body.vehicle_state.tpms_pressure_rr} * 100 / ${target-tire-pressure-rear}",
		"percent_of_max_pressure_front_left": "14.503773773 * ${body.vehicle_state.tpms_pressure_fl} * 100 / ${target-tire-pressure-front-max}",
		"percent_of_max_pressure_front_right": "14.503773773 * ${body.vehicle_state.tpms_pressure_fr} * 100 / ${target-tire-pressure-front-max}",
		"percent_of_max_pressure_rear_left": "14.503773773 * ${body.vehicle_state.tpms_pressure_rl} * 100 / ${target-tire-pressure-rear-max}",
		"percent_of_max_pressure_rear_right": "14.503773773 * ${body.vehicle_state.tpms_pressure_rr} * 100 / ${target-tire-pressure-rear-max}"
	},
	"conditions": {
		"check-event-type": " '${headers.calling_action}'.includes('call-tesla-get-data-0') ",
		"check-event-vehicle": " '${headers.calling_action_endpoint}'.includes('${tesla-api-url-base}') ",
		"check-dist": " ${distance_to_work} > 0.0 "
	},
	"_conditions": {
		"check-device-direct-1": " '${body.display_name}' === 'Nameless Midnight' "
	},
	"actions": {
		"01 - action-tag": { 
			"type": "tag", 
			"value": "set - tesla data",
			"expire": 999999
		},
		"action-set-var tesla root": { 
			"type": "set", 
			"name": "Vehicles",
			"path": "$.Tesla_0",
			"value": "${body.display_name}",
			"add": {
				"car_version": "${body.vehicle_state.car_version}",
				"odometer": "${body.vehicle_state.odometer}",
				"homelink_nearby": "${body.vehicle_state.homelink_nearby}",
				"software_update_status": "${body.vehicle_state.software_update.status}",
				"distance_to_home": "${distance_to_home}",
				"distance_to_work": "${distance_to_work}"
			}
		},
		"action-set-var tesla tires": { 
			"type": "set", 
			"name": "Vehicles",
			"path": "$.Tesla_0.tires",
			"value": "${body.display_name}",
			"add": {
				"pressure_bar_front_left": "${body.vehicle_state.tpms_pressure_fl}",
				"pressure_bar_front_right": "${body.vehicle_state.tpms_pressure_fr}",
				"pressure_bar_rear_left": "${body.vehicle_state.tpms_pressure_rl}",
				"pressure_bar_rear_right": "${body.vehicle_state.tpms_pressure_rr}",
				"pressure_psi_front_left": "${psi_pressure_front_left}",
				"pressure_psi_front_right": "${psi_pressure_front_right}",
				"pressure_psi_rear_left": "${psi_pressure_rear_left}",
				"pressure_psi_rear_right": "${psi_pressure_rear_right}",

				"pressure_percent_front_left": "${percent_pressure_front_left}",
				"pressure_percent_front_right": "${percent_pressure_front_right}",
				"pressure_percent_rear_left": "${percent_pressure_rear_left}",
				"pressure_percent_rear_right": "${percent_pressure_rear_right}",
				"pressure_psi_target_front": "${target-tire-pressure-front}",
				"pressure_psi_target_rear": "${target-tire-pressure-rear}",

				"pressure_percent_of_max_front_left": "${percent_of_max_pressure_front_left}",
				"pressure_percent_of_max_front_right": "${percent_of_max_pressure_front_right}",
				"pressure_percent_of_max_rear_left": "${percent_of_max_pressure_rear_left}",
				"pressure_percent_of_max_rear_right": "${percent_of_max_pressure_rear_right}",
				"pressure_psi_max_front": "${target-tire-pressure-front-max}",
				"pressure_psi_max_rear": "${target-tire-pressure-rear-max}"
			}
		},
		"action-set-var tesla drive-state": { 
			"type": "set", 
			"name": "Vehicles",
			"path": "$.Tesla_0.drive_state",
			"value": "${body.display_name}",
			"add": {
				"heading": "${body.drive_state.heading}",
				"latitude": "${body.drive_state.latitude}",
				"longitude": "${body.drive_state.longitude}",
				"shift_state": "${body.drive_state.shift_state}",
				"speed": "${body.drive_state.speed}"
			}
		},
		"action-set-var tesla charge-state": { 
			"type": "set", 
			"name": "Vehicles",
			"path": "$.Tesla_0.charge_state",
			"value": "${body.display_name}",
			"add": {
				"battery_level": "${body.charge_state.battery_level}",
				"battery_range": "${body.charge_state.battery_range}",
				"est_battery_range": "${body.charge_state.est_battery_range}",
				"charging_state": "${body.charge_state.charging_state}"
			}
		},
		"action-set-var tesla closures": { 
			"type": "set", 
			"name": "Vehicles",
			"path": "$.Tesla_0.closures",
			"value": "${body.display_name}",
			"add": {
				"locked": "${body.vehicle_state.locked}",
				"sun_roof_state": "${body.vehicle_state.sun_roof_state}",
				"door_front_left_open": "${body.vehicle_state.df}",
				"door_front_right_open": "${body.vehicle_state.pf}",
				"door_rear_left_open": "${body.vehicle_state.dr}",
				"door_rear_right_open": "${body.vehicle_state.pr}",
				"trunk_front_open": "${body.vehicle_state.ft}",
				"trunk_rear_open": "${body.vehicle_state.rt}"
			}
		}	
	}
}
