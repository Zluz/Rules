{
	"debug": false,
	"conditions": {
		"check-event-type": "'${headers.event-type}'.includes('Powerwall measurement')",
		"check-event-source": "'${headers.user-agent}'.includes('Telegraf')",
		"check-array-item": "'${headers.reprocess_key}'.includes('split-bulk-array')",
		"check-measurement-type": "'${body.name}' === 'alerts'",
		"enabled": "true"
	},
	"actions": {
		"01 - action-tag": { 
			"type": "tag", 
			"value": "set - PW alert",
			"expire": -1
		},
		"02 - action-set-var home.upstairs": { 
			"type": "set", 
			"name": "Home",
			"path": "$.batteries.${headers.powerwall}.alert",
			"options": "update-if-resolved",
			"value": "${headers.powerwall}",
			"add": {
			    "grid_status": "${body.fields.grid_status}",
			    "SystemConnectedToGrid": "${body.fields.SystemConnectedToGrid}"
			}
		}
	}
}

